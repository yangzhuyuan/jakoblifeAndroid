{"version":3,"sources":["uni_modules/laoqianjunzi-alarm/utssdk/app-android/index.uts","uni_modules/laoqianjunzi-alarm/utssdk/interface.uts"],"sourcesContent":["import {\r\n\tUTSAndroid\r\n} from \"io.dcloud.uts\";\r\n\r\nimport { AddParams, AddOptions, DeleteParams, DeleteOptions, Results } from \"../interface.uts\"\r\nimport Intent from 'android.content.Intent';\r\nimport AlarmClock from 'android.provider.AlarmClock';\r\nimport Uri from 'android.net.Uri';\r\nimport Activity from 'android.app.Activity';\r\nimport ActivityCompat from \"androidx.core.app.ActivityCompat\";\r\nimport Manifest from \"android.Manifest\";\r\n\r\nimport Context from 'android.content.Context';\r\nimport ContentUris from 'android.content.ContentUris';\r\nimport ContentValues from 'android.content.ContentValues';\r\nimport Color from 'android.graphics.Color';\r\nimport Cursor from 'android.database.Cursor';\r\n\r\nimport CalendarContract from 'android.provider.CalendarContract';\r\nimport Calendar from 'java.util.Calendar';\r\nimport TimeZone from 'java.util.TimeZone';\r\nimport PackageManager from \"android.content.pm.PackageManager\";\r\nimport TextUtils from 'android.text.TextUtils';\r\n\r\nimport ArrayList from 'java.util.ArrayList';\r\nimport Int from 'kotlin.Int';\r\nclass AlarmUtils {\r\n\r\n\t/**\r\n\t * 添加闹钟事件\r\n\t */\r\n\taddEvent(params : AddParams) {\r\n\t\tconsole.log(\"addEvent\");\r\n\t\tlet clock_name : string = params.name;\r\n\t\tlet clock_hour : number = params.hour;\r\n\t\tlet clock_minutes : number = params.minutes;\r\n\t\tlet clock_ringtone : string = params.ringtone;\r\n\t\tlet clock_weekdays : string = params.weekday\r\n\t\tlet intent : Intent = new Intent(AlarmClock.ACTION_SET_ALARM);\r\n\r\n\t\tintent.putExtra(AlarmClock.EXTRA_HOUR, clock_hour);\r\n\t\tintent.putExtra(AlarmClock.EXTRA_MINUTES, clock_minutes);\r\n\t\tintent.putExtra(AlarmClock.EXTRA_MESSAGE, clock_name);\r\n\t\tintent.putExtra(AlarmClock.EXTRA_VIBRATE, true);\r\n\t\tintent.putExtra(AlarmClock.EXTRA_SKIP_UI, true);\r\n\r\n\t\tif (TextUtils.isEmpty(clock_ringtone)) {\r\n\t\t\tintent.putExtra(AlarmClock.VALUE_RINGTONE_SILENT, true);\r\n\t\t} else {\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_RINGTONE, clock_ringtone);\r\n\t\t}\r\n\r\n\t\tif (!TextUtils.isEmpty(clock_weekdays)) {\r\n\t\t\tlet clock_days : ArrayList<Int> = new ArrayList<Int>();\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '1') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.MONDAY);//周一\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '2') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.TUESDAY);//周二\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '3') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.WEDNESDAY);//周三\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '4') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.THURSDAY);//周四\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '5') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.FRIDAY);//周五\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '6') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.SATURDAY);//周六\r\n\t\t\t}\r\n\t\t\tif (TextUtils.indexOf(clock_weekdays, '7') !== -1) {\r\n\t\t\t\tclock_days.add(Calendar.SUNDAY);//周日\r\n\t\t\t}\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_DAYS, clock_days);\r\n\t\t}\r\n\r\n\t\tintent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);\r\n\r\n\t\tlet packageManager = UTSAndroid.getUniActivity()!.getPackageManager();\r\n\t\tvar component = intent.resolveActivity(packageManager);\r\n\t\tif (component != null) {\r\n\t\t\tUTSAndroid.getUniActivity()!.startActivity(intent);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 删除事件\r\n\t */\r\n\tdeleteEvent() {\r\n\t\tlet clock_name : string = 'dida';\r\n\t\tvar hour = '05';\r\n\t\tvar minutes = '40';\r\n\t\tlet intent : Intent = new Intent(AlarmClock.ACTION_DISMISS_ALARM);\r\n\t\tconsole.log('clock_name', clock_name)\r\n\t\tif (!TextUtils.isEmpty(clock_name)) { //通过标签取消\r\n\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_ALARM_SEARCH_MODE, AlarmClock.ALARM_SEARCH_MODE_LABEL);\r\n\t\t\tintent.putExtra(AlarmClock.ALARM_SEARCH_MODE_LABEL, clock_name);\r\n\t\t\t//intent.putExtra(AlarmClock.EXTRA_MESSAGE, clock_name);\r\n\t\t\tconsole.log('通过标签取消')\r\n\t\t} else { //通过小时分钟取消\r\n\t\t\tconsole.log('通过小时分钟取消')\r\n\t\t\tlet is_pm = true\r\n\t\t\tintent.putExtra(AlarmClock.ALARM_SEARCH_MODE_TIME, 1);\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_IS_PM, is_pm); //其中false = AM且true = PM\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_HOUR, hour);\r\n\t\t\tintent.putExtra(AlarmClock.EXTRA_MINUTES, minutes);\r\n\t\t}\r\n\t\tintent.putExtra(AlarmClock.EXTRA_SKIP_UI, true);\r\n\t\tintent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\r\n\r\n\t\tlet packageManager = UTSAndroid.getUniActivity()!.getPackageManager();\r\n\t\tvar component = intent.resolveActivity(packageManager);\r\n\t\tif (component != null) {\r\n\t\t\tUTSAndroid.getUniActivity()!.startActivity(intent);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * 添加闹钟\r\n */\r\nexport function alarmAdd(opts : AddOptions) {\r\n\tconsole.log('alarmAdd', UTSAndroid, UTSAndroid.getUniActivity())\r\n\t// 检查相关权限是否已经具备\r\n\tif (ActivityCompat.checkSelfPermission(UTSAndroid.getUniActivity()!, Manifest.permission.SET_ALARM) != PackageManager.PERMISSION_GRANTED) {\r\n\t\t// 不具备权限，申请权限，并且告知用户监听失败\r\n\t\tActivityCompat.requestPermissions(UTSAndroid.getUniActivity()!, arrayOf(Manifest.permission.SET_ALARM), 1001)\r\n\t\t// 因权限缺失导致监听失败\r\n\t\tconst ret : Results = {\r\n\t\t\tcode: -1,\r\n\t\t\tdata: \"权限\",\r\n\t\t\tmsg: \"不具备权限，请申请权限\"\r\n\t\t}\r\n\t\topts.fail(ret);\r\n\r\n\t} else {\r\n\t\tlet alarm_utils = new AlarmUtils();\r\n\t\tlet params : AddParams = opts.params\r\n\r\n\t\talarm_utils.addEvent(params);\r\n\t\tconst ret : Results = {\r\n\t\t\tcode: 1,\r\n\t\t\tdata: \"成功\",\r\n\t\t\tmsg: \"添加闹铃成功\"\r\n\t\t}\r\n\t\topts.success(ret);\r\n\t}\r\n\r\n\topts.complete();\r\n}\r\n\r\n\r\n/**\r\n * 删除闹钟\r\n */\r\nexport function alarmDelete() {\r\n\tlet alarm_utils = new AlarmUtils();\r\n\tconsole.log(\"======alarmDelete\");\r\n\talarm_utils.deleteEvent();\r\n}","export type AddParams = {\r\n\tname : string, //闹铃名称\r\n\tweekday : string, //重复星期\r\n\thour : number, //闹铃时\r\n\tminutes : number, //分钟\r\n\tringtone : string, //铃声\r\n}\r\nexport type DeleteParams = {\r\n\tname : string, //名称\r\n}\r\n\r\nexport type Results = {\r\n\tcode : number,\r\n\tdata : string | null,\r\n\tmsg : string,\r\n}\r\n\r\nexport type AddOptions = {\r\n\tparams : AddParams;\r\n\tsuccess : (res : Results) => void;\r\n\tfail : (err : Results) => void;\r\n\tcomplete : () => void;\r\n}\r\nexport type DeleteOptions = {\r\n\tparams : DeleteParams;\r\n\tsuccess : (res : Results) => void;\r\n\tfail : (err : Results) => void;\r\n\tcomplete : () => void;\r\n}"],"names":[],"mappings":"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"}